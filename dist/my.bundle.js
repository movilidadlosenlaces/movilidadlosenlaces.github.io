var Panel=function(){var e=$("#page-loader"),a=$("#sectorChooser"),n=$("#premiumFeatureOnly"),t=document.getElementById("displayMyWorks"),l=document.getElementById("displayCollaboratives"),i=document.getElementById("displayPurchases"),o=$(document.getElementById("searchForWorks")),c=[],s=[],r=[],d="none",u="",f="",v="",m=$("#myWorks"),p=$("#purchases"),h=$("#collaboratives"),y=$(".sector-selector"),g=$("#validateSectorChoose"),k={myWorks:"/api/Panel/GetMyWorks",purchases:"/api/Panel/GetPurchasedTemplates",duplicateGenially:"/api/Panel/DuplicateGenially",removeGenially:"/api/Panel/RemoveGenially",transferGenially:"/api/Panel/TransferGenially",checkAccountConfirmed:"/api/User/CheckUserIsConfirmed",checkUpdatePolicy:"/api/User/UpdatePolicy",checkGeniallyOcupied:"/api/Panel/CheckGeniallyOcupied",updateSectorInfor:"/api/User/UpdateSectorInfo",getSectorStatus:"/api/User/GetSectorStatus",directCreate:"/api/Panel/DirectCreate"},C=function(){e.show()},w=function(){e.hide()},G=function(){function e(e){c.unshift(e[0]);var a=Genially.templates.genially(e);a=$.parseHTML(a.trim()),m.prepend(a),w()}C();var a={idGeniallyToDuplicate:$(this).data("id-genially")};ApiGenially.executeCall(a,k.duplicateGenially,"GET",e)},E=function(){var e={idGeniallyToRemove:$(this).data("id-genially")};swal({title:locale.panel.confirmQuestion,text:locale.panel.actionPermanent,type:"warning",showCancelButton:!0,confirmButtonColor:"#079dac",confirmButtonText:locale.panel.confirmDeleteButton,closeOnConfirm:!0},function(){function a(){document.getElementById("work-"+e.idGeniallyToRemove).remove(),w()}C(),ApiGenially.executeCall(e,k.removeGenially,"GET",a)})},I=function(){var e=$(this).data("id-genially");return""!==e&&null!==e&&"undefined"!=typeof e&&void swal({title:locale.panel.transferTitle,text:locale.panel.transferDescription,type:"input",showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#079dac",animation:"slide-from-top",inputPlaceholder:locale.panel.transferPlaceholder},function(a){function n(){swal(locale.panel.nice,locale.panel.transfered+a,"success"),w()}if(a===!1)return!1;if(""===a||!helper.validateEmail(a))return swal.showInputError(locale.panel.inputError),!1;$(".confirm").hide(),C();var t={idGeniallyToTransfer:e,userEmailToTransfer:a};ApiGenially.executeCall(t,k.transferGenially,"GET",n)})},L=function(e){e.preventDefault();var a=parseInt($(this).attr("data-allowed"),10)>=2;if(!a){var t=$(this).data("id-genially"),l=n.find("#levelGeniallyUp");l.attr("href","/Buy/Professional/"+t),n.modal();try{ga("send","event","LevelUp",t)}catch(e){}return!1}var i=$(this).attr("href");location.href=i},T=function(){var e=$("#policy").val();"v1"!==e&&(notify.message=locale.panel.accountPolicy,notify.type="inverse",notify.delay=2e7,notify.show(),$("#render-body").css({opacity:.1,"pointer-events":"none","user-select":"none"}),$(document).on("click",".accept-button",function(){function e(){$("#render-body").css({opacity:1,"pointer-events":"","user-select":""}),$(".alert").fadeOut()}ApiGenially.executeCall("",k.checkUpdatePolicy,"PUT",e)}))},b=function(){function e(e){e?localStorage.setItem("checkAccountActive-"+a,"active"):(notify.message=locale.panel.accountNotActive,notify.type="inverse",notify.delay=1e4,notify.show())}var a=$("#idUser").val(),n=localStorage.getItem("checkAccountActive-"+a);null===n&&ApiGenially.executeCall("",k.checkAccountConfirmed,"GET",e)},O=function(e){function a(e){e?swal(locale.panel.geniallyOcupiedTitle,locale.panel.geniallyOcupiedDescription+e,"warning"):location.href="/Editor/Index/"+n}e.preventDefault();var n=$(this).data("id-genially"),t={idGenially:n};ApiGenially.executeCall(t,k.checkGeniallyOcupied,"GET",a)},S=function(){function e(e){null===e||""===e?(a.addClass("fadeIn"),a.show(),a.find(".chooser-modal").addClass("bounceIn"),localStorage.setItem("new-sector-"+n,e)):(a.remove(),localStorage.setItem("new-sector-"+n,e))}var n=$("#idUser").val();null===localStorage.getItem("new-sector-"+n)||"null"===localStorage.getItem("new-sector-"+n)?ApiGenially.executeCall("",k.getSectorStatus,"GET",e):a.remove()},U=function(){$(".sector-selector").removeClass("active"),$(this).addClass("active"),g.addClass("selected-active"),setTimeout(function(){D()},500)},D=function(){function e(e){var a=$("#sectorChooser");a.addClass("fadeOut"),a.remove(),a.find(".chooser-modal").addClass("bounceOut")}var a=$(".sector-selector.active").length;if(0!==a){a=$(".sector-selector.active").attr("sector");var n={sector:a};ApiGenially.executeCall(n,k.updateSectorInfor,"POST",e)}},P=function(){$(this).css("pointer-events","none");try{ga("send","event","FromCustom",d)}catch(e){}},A=function(){try{ga("send","event","Behaviour","Download",$(this).attr("data-id-genially"))}catch(e){}},x=function(){var e=navigator.language?navigator.language:navigator.userLanguage;moment.locale(e)},B=function(){$(window).scroll(function(e){var a=$(window).scrollTop();a>=200?$("div.scrollTop").fadeIn():a<200&&$("div.scrollTop").fadeOut()}),$("#scrollTop").on("click",function(e){$("html, body").animate({scrollTop:0},"slow")})},W=function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})},z=function(){"myWorks"!==d&&(d="myWorks",o.val(u),$(i).removeClass("active"),$(l).removeClass("active"),$(t).addClass("active"),t.removeEventListener("click",z),l.removeEventListener("click",F),i.removeEventListener("click",N),p.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),h.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),m.removeClass("fadeOutDown").addClass("fadeInUp").delay(800).show(),m.imagesLoaded(function(){}),setTimeout(function(){t.addEventListener("click",z),l.addEventListener("click",F),i.addEventListener("click",N)},1e3))},F=function(){"collaborative"!==d&&(d="collaborative",o.val(f),$(t).removeClass("active"),$(i).removeClass("active"),$(this).addClass("active"),t.removeEventListener("click",z),l.removeEventListener("click",F),i.removeEventListener("click",N),m.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),p.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),h.removeClass("fadeOutDown").addClass("fadeInUp").delay(800).show(),h.imagesLoaded(function(){}),setTimeout(function(){t.addEventListener("click",z),l.addEventListener("click",F),i.addEventListener("click",N)},1e3),setTimeout(function(){h.find(".lazy").lazyload({skip_invisible:!1,threshold:800})},400))},N=function(){"purchases"!==d&&(d="purchases",o.val(v),$(t).removeClass("active"),$(l).removeClass("active"),$(this).addClass("active"),t.removeEventListener("click",z),l.removeEventListener("click",F),i.removeEventListener("click",N),h.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),m.removeClass("fadeInUp").addClass("fadeOutDown").delay(800).hide(),p.removeClass("fadeOutDown").addClass("fadeInUp").delay(800).show(),p.imagesLoaded(function(){}),setTimeout(function(){t.addEventListener("click",z),l.addEventListener("click",F),i.addEventListener("click",N)},1e3),setTimeout(function(){p.find(".lazy").lazyload({skip_invisible:!1,threshold:800})},400))},R=function(e,a){function n(e){return a(!0)}function t(a){return $.each(a,function(e,a){switch(a.IsCollaborative){case!0:s.push(a);break;case!1:c.push(a)}}),0!==c.length&&m.html(Genially.templates.genially(c)),h.html(Genially.templates.genially(s)),e(!0)}var l={language:"ES"};ApiGenially.executeCall(l,k.myWorks,"GET",t,n)},M=function(e,a){function n(e){return a(!0)}function t(a){return $.each(a,function(e,a){r.push(a)}),p.html(Genially.templates.purchased(r)),e(!0)}var l={language:"ES"};ApiGenially.executeCall(l,k.purchases,"GET",t,n)},H=function(){var e=$(this).val().trim();e=removeDiacritics(e);var a=new RegExp(e,"ig");"myWorks"===d?(u=e,$.each(c,function(e,n){if(!n.IsCollaborative){var t=document.getElementById("work-"+n.Id),l=removeDiacritics(n.Name);null!==t&&(l.match(a)?t.classList.remove("hidden"):t.classList.add("hidden"))}})):"collaborative"===d?(f=e,$.each(s,function(e,n){if(n.IsCollaborative){var t=document.getElementById("work-"+n.Id),l=removeDiacritics(n.Name);null!==t&&(l.match(a)?t.classList.remove("hidden"):t.classList.add("hidden"))}})):"purchases"===d&&(v=e,$.each(r,function(e,n){var t=document.getElementById("purchase-"+n.Id),l=removeDiacritics(n.Name);null!==t&&(l.match(a)?t.classList.remove("hidden"):t.classList.add("hidden"))}))},Q=function(){$(document).on("click",".duplicate-genially",G),$(document).on("click",".delete-genially",E),$(document).on("click",".transfer-genially",I),$(document).on("click",".checkGeniallyOcupied",O),$(document).on("click",".statisticsLink",C),y.click(U),g.click(D),$("#createNewGeniallyFromScratch").click(P),$(document).on("click",".download-genially",A),$(document).on("click",".export-genially",L),t.addEventListener("click",z),l.addEventListener("click",F),i.addEventListener("click",N),o.on("keyup",_.debounce(H,300))},j=function(){R(function(e,a){if(e){if(0===c.length)switch($("#no-geniallys").show(),language){case"es-ES":$('.no-creations-image[data-language="es"]').show();break;case"en-US":$('.no-creations-image[data-language="en"]').show();break;case"fr-FR":$('.no-creations-image[data-language="fr"]').show();break;default:$('.no-creations-image[data-language="en"]').show()}M(function(e,a){e&&(m.imagesLoaded(function(){setTimeout(function(){t.click()},200)}),h.imagesLoaded(function(){}),p.imagesLoaded(function(){}))})}}),a.hide(),helper.beautifulInputText(),helper.wavesButtons(),x(),B(),W(),Q(),$(".contracted-logo").click(function(){$("html, body").animate({scrollTop:0},"slow")}),$(document).on("click",".share-genially",function(){var e=$(this).data("id-genially");Share.shareGenially(e)}),$(".work-link").click(function(){window.open($(this).data("link"),"_blank")}),S(),Share.init(),m.hide(),h.hide(),p.hide(),w(),b(),T(),$(".selectpicker").on("changed.bs.select",function(e){})};return{initialize:j,duplicateGenially:G,deleteGenially:E,transferGenially:I,checkAccountPolicy:T,checkAccountConfirmed:b,checkGeniallyOcupied:O,showLoader:C}}();